import*as e from"https://threejs.org/build/three.module.js";import t from"https://threejs.org/examples/jsm/libs/stats.module.js";import{CinematicCamera as o}from"https://threejs.org/examples/jsm/cameras/CinematicCamera.js";let n=new t;document.body.appendChild(n.dom);const l=new e.Vector2;document.addEventListener("mousemove",(function(e){e.preventDefault(),l.x=e.clientX/window.innerWidth*2-1,l.y=-e.clientY/window.innerHeight*2+1})),window.addEventListener("resize",(function(){i.aspect=window.innerWidth/window.innerHeight,i.updateProjectionMatrix(),r.setSize(window.innerWidth,window.innerHeight)}));const s=new e.Scene,i=new o(75,window.innerWidth/window.innerHeight,1,1e3);i.setLens(15),i.position.set(2,1,500);const r=new e.WebGLRenderer({canvas:document.querySelector("#bg")});r.setPixelRatio(window.devicePixelRatio),r.setSize(window.innerWidth,window.innerHeight),i.position.setZ(30),i.position.setX(-3),r.render(s,i);let c,a,m,d,u={theme1:{matColor:"0xffffff",emiColor:"0xff0000",bgColor:"0xf0f0f0",wireframe:!1,cubesNeededToUnlock:0},theme2:{matColor:"0x00ffff",emiColor:"0xff0000",bgColor:"0xf0f0f0",ambientLight:"0xffffff",wireframe:!1,cubesNeededToUnlock:500},theme3:{matColor:"0x000000",emiColor:"0xff0000",bgColor:"0xf0f0f0",ambientLight:"0xffffff",wireframe:!1,cubesNeededToUnlock:1500},theme4:{matColor:"0xffffff",emiColor:"0xff0000",bgColor:"0xf0f0f0",ambientLight:"0xffffff",wireframe:!0,cubesNeededToUnlock:5e3},theme5:{matColor:"0xFFF033",emiColor:"0xFFF033",bgColor:"0x000000",ambientLight:"0x0000ff",wireframe:!1,cubesNeededToUnlock:1e4},theme6:{matColor:"0xffffff",emiColor:"0xffffff",bgColor:"0xf0f0f0",ambientLight:"0xffffff",wireframe:!1,cubesNeededToUnlock:25e3}};localStorage.getItem("theme")||localStorage.setItem("theme","theme1");let g=localStorage.getItem("theme")||"theme1",f=parseInt(localStorage.getItem("cubeTotal"),10);function h(){f=parseInt(localStorage.getItem("cubeTotal"),10),Object.keys(u).forEach((e=>{var t;u[e].cubesNeededToUnlock<=f&&(t=e,document.getElementById(t).style.display="block")}))}sessionStorage.setItem("showGuide",!0);let y=u.theme6.cubesNeededToUnlock;function p(){s.add(new e.AmbientLight(g.ambientLight,.3));const t=new e.DirectionalLight(16777215,.35);t.position.set(1,1,1).normalize(),s.add(t),g=localStorage.getItem("theme")||"theme1",f=parseInt(localStorage.getItem("cubeTotal"),10),h(),f=parseInt(localStorage.getItem("cubeTotal"),10),f>=u.theme6.cubesNeededToUnlock?y="All themes unlocked!":Object.keys(u).forEach((e=>{y>u[e].cubesNeededToUnlock&&u[e].cubesNeededToUnlock>f&&(y=u[e].cubesNeededToUnlock)})),document.getElementById("cubesUntilNextThemeUnlock").innerHTML="All themes unlocked!"==y?y:`Next theme unlocked ${f}/${y}`;const o=new e.BoxGeometry(20,20,20),n=u[g].matColor,l=u[g].wireframe;for(let i=0;i<1500;i++){const t=new e.Mesh(o,new e.MeshLambertMaterial({color:Math.random()*n,wireframe:l}));t.position.x=800*Math.random()-400,t.position.y=800*Math.random()-400,t.position.z=800*Math.random()-400,s.add(t)}s.background=new e.Color(g.bgColor),c=0,document.getElementById("score").innerText=c,a=!1,m=!1,d=sessionStorage.getItem("showGuide"),document.getElementById("guide-text").style.display="true"==d?"inline":"none",document.getElementById("game-over-header").style.display="none",document.getElementById("start-header").style.display="inline-block",document.getElementById("start-header").onmouseover=function(){document.getElementById("start-header").style.borderRadius="25px 0 25px 25px",document.getElementById("close").style.display="inline"},document.getElementById("start-header").onmouseout=function(){document.getElementById("start-header").style.borderRadius="25px",document.getElementById("close").style.display="none"},document.getElementById("close").onclick=function(e){document.getElementById("start-header").style.display="none",e.stopPropagation()},document.onclick=S}p();let b,w,I=0;b=new e.Raycaster;let x,E,k,B=Date.now();const C={focalLength:15,fstop:22,maxblur:0,showFocus:!1,focalDepth:3};function S(){document.getElementById("score-header").style.display="inline-block",document.getElementById("start-header").style.display="none",c=0,m||(a=!0),document.onclick=null}let T;function v(e){return e>=150?'<img src="./icons/diamond.png" class="score-icon"></img>':e>=100?'<img src="./icons/gold.png" class="score-icon"></img>':e>=50?'<img src="./icons/silver.png" class="score-icon"></img>':e>=25?'<img src="./icons/bronze.png" class="score-icon"></img>':""}function L(e){return e>=25?"&nbsp&nbsp&nbsp":""}function N(){g=localStorage.getItem("theme");for(let e=0;e<document.getElementsByClassName("xyz").length;e++)document.getElementsByClassName("xyz")[e].style.backgroundColor=null,document.getElementsByClassName("xyz")[e].style.color="grey",document.getElementsByClassName("xyz")[e].onmouseover=function(e){e.target.style.color="white"},document.getElementsByClassName("xyz")[e].onmouseout=function(e){e.target.style.color=""};document.getElementById(g).style.backgroundColor="#157392",document.getElementById(g).style.color="white",document.getElementById(g).onmouseout=function(e){e.target.style.color="white"},document.getElementById(g).style.color="white"}function M(e){document.getElementById(e).onclick=function(){!function(e){localStorage.setItem("theme",e)}(e),N(),U(),event.stopPropagation()}}function U(){s.clear(),p()}!function(){for(const e in C)e in i.postprocessing.bokeh_uniforms&&(i.postprocessing.bokeh_uniforms[e].value=C[e]);i.postprocessing.bokeh_uniforms.znear.value=i.near,i.postprocessing.bokeh_uniforms.zfar.value=i.far,i.setLens(C.focalLength,i.frameHeight,C.fstop,i.coc),C.focalDepth=i.postprocessing.bokeh_uniforms.focalDepth.value}(),function t(){x=1e3/(Date.now()-B),B=Date.now(),E=x,requestAnimationFrame(t),n.update(),k=144/E,a&&(I+=.02*k),i.position.x=200*Math.sin(e.MathUtils.degToRad(I)),i.position.y=200*Math.sin(e.MathUtils.degToRad(I)),i.position.z=200*Math.cos(e.MathUtils.degToRad(I)),i.lookAt(s.position),b.setFromCamera(l,i);const o=b.intersectObjects(s.children);a&&(o.length>0?w!=o[0].object&&(a||w&&w.material.emissive.setHex(w.currentHex),w=o[0].object,w.material.emissive.getHex()!=u[g].emiColor&&a&&(c+=1,document.getElementById("score").innerText=c),w.material.emissive.setHex(u[g].emiColor)):(!function(){localStorage.getItem("cubeTotal")?(f=parseInt(localStorage.getItem("cubeTotal"),10),localStorage.setItem("cubeTotal",f+c)):localStorage.setItem("cubeTotal",c);T=localStorage.getItem("highScore"),c>T&&localStorage.setItem("highScore",c);document.getElementById("game-over-header").style.display="inline-block",document.getElementById("your-score").innerHTML=`Your Score: ${c}`+L(c)+v(c),document.getElementById("your-high-score").innerHTML=`Your High Score:  ${localStorage.getItem("highScore")}`+L(T)+v(localStorage.getItem("highScore")),document.onclick=U,sessionStorage.setItem("showGuide",!1)}(),m=!0,a=!1,document.getElementById("score").innerText=c,w=null)),i.postprocessing.enabled?i.renderCinematic(s,r):(s.overrideMaterial=null,r.clear(),r.render(s,i))}(),document.onclick=S,document.getElementById("dropdown").onmouseover=function(){document.getElementById("dropdown-content").style.display="block"},document.getElementById("dropdown").onmouseout=function(){document.getElementById("dropdown-content").style.display="none"},N(),Object.keys(u).forEach((e=>M(e)));
