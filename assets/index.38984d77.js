import*as e from"https://threejs.org/build/three.module.js";import t from"https://threejs.org/examples/jsm/libs/stats.module.js";import{CinematicCamera as n}from"https://threejs.org/examples/jsm/cameras/CinematicCamera.js";let o=new t;document.body.appendChild(o.dom);const i=new e.Vector2;document.addEventListener("mousemove",(function(e){e.preventDefault(),i.x=e.clientX/window.innerWidth*2-1,i.y=-e.clientY/window.innerHeight*2+1})),window.addEventListener("resize",(function(){s.aspect=window.innerWidth/window.innerHeight,s.updateProjectionMatrix(),a.setSize(window.innerWidth,window.innerHeight)}));const r=new e.Scene,s=new n(75,window.innerWidth/window.innerHeight,1,1e3);s.setLens(15),s.position.set(2,1,500);const a=new e.WebGLRenderer({canvas:document.querySelector("#bg")});a.setPixelRatio(window.devicePixelRatio),a.setSize(window.innerWidth,window.innerHeight),s.position.setZ(30),s.position.setX(-3),a.render(r,s),r.add(new e.AmbientLight(16777215,.3));const c=new e.DirectionalLight(16777215,.35);c.position.set(1,1,1).normalize(),r.add(c);const d=new e.BoxGeometry(20,20,20);for(let j=0;j<1500;j++){const t=new e.Mesh(d,new e.MeshLambertMaterial({color:16777215*Math.random()}));t.position.x=800*Math.random()-400,t.position.y=800*Math.random()-400,t.position.z=800*Math.random()-400,r.add(t)}r.background=new e.Color(15790320);let l,m,h=0;l=new e.Raycaster;let u,p,g,w=0,f=!1,y=!1,b=Date.now();const x={focalLength:15,fstop:22,maxblur:0,showFocus:!1,focalDepth:3};let v;function M(){return location.reload(),!1}!function(){for(const e in x)e in s.postprocessing.bokeh_uniforms&&(s.postprocessing.bokeh_uniforms[e].value=x[e]);s.postprocessing.bokeh_uniforms.znear.value=s.near,s.postprocessing.bokeh_uniforms.zfar.value=s.far,s.setLens(x.focalLength,s.frameHeight,x.fstop,s.coc),x.focalDepth=s.postprocessing.bokeh_uniforms.focalDepth.value}(),function t(){u=1e3/(Date.now()-b),b=Date.now(),p=u,requestAnimationFrame(t),o.update(),g=144/p,f&&(h+=.02*g),s.position.x=200*Math.sin(e.MathUtils.degToRad(h)),s.position.y=200*Math.sin(e.MathUtils.degToRad(h)),s.position.z=200*Math.cos(e.MathUtils.degToRad(h)),s.lookAt(r.position),l.setFromCamera(i,s);const n=l.intersectObjects(r.children);f&&(n.length>0?m!=n[0].object&&(f||m&&m.material.emissive.setHex(m.currentHex),m=n[0].object,16711680!=m.material.emissive.getHex()&&f&&(w+=1,document.getElementById("score").innerText=w),m.material.emissive.setHex(16711680)):(!function(){v=localStorage.getItem("highScore"),w>v&&localStorage.setItem("highScore",w);document.getElementById("game-over-header").style.display="inline",document.getElementById("your-score").innerText=`Your Score:  ${w}`,document.getElementById("your-high-score").innerText=`Your High Score:  ${localStorage.getItem("highScore")}`,document.onclick=M}(),y=!0,f=!1,document.getElementById("score").innerText=w,m=null)),s.postprocessing.enabled?s.renderCinematic(r,a):(r.overrideMaterial=null,a.clear(),a.render(r,s))}(),document.onclick=function(){document.getElementById("score-header").style.display="inline-block",document.getElementById("start-header").style.display="none",w=0,y||(f=!0);document.onclick=null};
